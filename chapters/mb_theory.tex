\documentclass[../main/report.tex]{subfiles}
\begin{document}
  
\chapter{Many-Body Theory and Implementation}
\label{cha:many-body} 

We have solved the nuclear two-body problem and studied its resonances.
The next step is to add another particle and subsequently solve the three-body problem. 
However, while the two-body problem is reducible to a radial one-dimensional problem, the general many-body problem is not.
Instead, we need to use a single particle (sp) basis to construct many-body states.
This chapter covers the construction of such states.

First, the mathematical consequences of identical, indistinguishable particles is presented, focusing on fermions.
This is followed by a short introduction to the second quantization formalism, which allows calculations with an arbitrary number of particles.
Finally, we discuss the use of second quantization in computations and present a simple implementation for fermions.

\todo{adapted from dickhoff (suhonen)}

\section{Identical Particles}

A quirk of quantum mechanics is that particles that look identical \emph{are} identical.
For example, in the case of the two neutrons orbiting the core, the neutrons are impossible to distinguish from one another. 
This has to be taken into consideration when dealing with many-body states of identical particles, as we will see.

We begin with an orthonormal single particle (sp) basis $\ket{\alpha_i}$, where $\alpha_i$ represents all the quantum numbers that describe the state.
Next, consider $N$ identical particles, expressed in this basis. We form a product state
\begin{eq}
  \pket{\alpha_1\alpha_2\dots\alpha_N} 
  \equiv
  \ket{\alpha_1} \otimes \ket{\alpha_2} \otimes \dots \otimes \ket{\alpha_N}
  =
  \ket{\alpha_1}\ket{\alpha_2}\dots\ket{\alpha_N},
\end{eq}
which, by the orthonormality of the $\ket\alpha$, will also be orthonormal
\begin{eq}
  \pbraket{\alpha_1\alpha_2\dots\alpha_N}{\alpha'_1\alpha'_2\dots\alpha'_N}
  =
  \braket{\alpha_1}{\alpha'_1}
  \braket{\alpha_2}{\alpha'_2}
  \dots
  \braket{\alpha_N}{\alpha'_N}.
\end{eq}

%Let us now create an arbitrary linear combination of the product states, denoted by an angled ket
Let us assume that the system of particles can be described by some linear combinations of these basis states, denoted \todo[inline]{make sure this assumption is verified later on, don't leave it hangin'}
\begin{eq}
  \ket{\alpha_1\alpha_2\dots\alpha_N}.
\end{eq}
Since the particles are identical, and thus indistinguishable, we require the norm of the state to be unchanged when swapping the quantum numbers of two particles $i$ and $j$
\begin{eq}
  \braket{\alpha_1\dots\alpha_i\dots\alpha_j\dots&\alpha_N}{\alpha_1\dots\alpha_i\dots\alpha_j\dots\alpha_N} \\
  &=\braket{\alpha_1\dots\alpha_j\dots\alpha_i\dots\alpha_N}{\alpha_1\dots\alpha_j\dots\alpha_i\dots\alpha_N}
\end{eq}
\todo[inline]{The equation above looks a bit weird now. Do something about it?}
These states can therefore only differ in phase $e^{i\phi}$, and since another swap will bring us back to the original state, the phase has to be either $e^{i\phi} = 1$ or $e^{i\phi} = -1$.
Symmetric states with no phase change describe \emph{bosons}, whereas antisymmetric states that change sign describe \emph{fermions}.
In this thesis all sp states will be fermionic, hence we do not treat the bosonic case.


\subsection{Antisymmetric Fermion states}

We have now established that our fermion many-body states are a linear combination of product states that satisfy
\begin{eq}
  \ket{\alpha_1\dots\alpha_i\dots\alpha_j\dots\alpha_N}
  =
  -\ket{\alpha_1\dots\alpha_j\dots\alpha_i\dots\alpha_N}.
\end{eq}
For example, in the case of two particles, the correctly normalized antisymmetric state is
\begin{eq}
  \ket{\alpha_1\alpha_2} 
  = 
  \frac{1}{\sqrt{2}}
  \bigp{
    \pket{\alpha_1\alpha_2} - \pket{\alpha_2\alpha_1}
  }.
\end{eq}
We will henceforth use the angular ket notation $\ket\dots$ for antisymmetric states, as opposed to $\pket\dots$ for product states.

\todo[inline]{pauli principle}
\todo[inline]{completeness relation? Orthonormality?}

It is important to note that states with permuted quantum numbers, such as the states $\ket{\alpha_1\alpha_2}$ and $\ket{\alpha_2\alpha_1}$, represent the same physical state, as they only differ in sign (phase). 
This means that we have to make sure not to double count these states. 
We can do this by requiring the sp states to always appear in the same order in the ket. 
If they are not, we permute two sp states at a time until the correct ordering is reached
\begin{eq}
  \ket{\alpha_i\alpha_1\dots\alpha_{i-1}\alpha_{i+1}\dots\alpha_N}
  & =
  - \ket{\alpha_1\alpha_i\dots\alpha_{i-1}\alpha_{i+1}\dots\alpha_N}
  \\ & =
  \dots
  \\ & =
  (-1)^{i-2} 
  \ket{\alpha_1\dots\alpha_i\alpha_{i-1}\alpha_{i+1}\dots\alpha_N}
  \\ & =
  (-1)^{i-1} 
  \ket{\alpha_1\dots\alpha_{i-1}\alpha_i\alpha_{i+1}\dots\alpha_N}.
\end{eq}

\section{Second quantization and Fock Space}

So far we've looked at a system with a fixed number of particles, but we want to work with a system with an arbitrary number of identical particles. 
The construction that lets us do this is called the \emph{Fock space}. 
\todo{why?/cite/explain citation at start of chapter, covering all our bases :)}
A state in Fock space, a \emph{Fock state}, can contain any number of particles. 
States with different number of particles are orthogonal to each other.

\subsection{Creation and Annihilation Operators}

\todo{particle addition/removal operators?}
The simplest Fock state is the \emph{vacuum state} $\ket{0}$, which describes a system with no particles. 
All other states can be created from the vacuum state using the \emph{creation operator} $a_\alpha^\dag$, which adds a particle with quantum numbers $\alpha$ to a state
\begin{eq}
  \label{eq:create}
  a_{\alpha}^{\dagger} \ket{\alpha_1 \alpha_2 ... \alpha_N} 
  =
  \ket{\alpha \alpha_1 \alpha_2 ... \alpha_N}.
\end{eq}
The resulting state will not necessarily be ordered, and the ordering might contribute a sign:
\begin{eq}
  \label{eq:create_ordered}
  a_{\alpha_i}^{\dagger} 
  \ket{\alpha_1 \alpha_2 ... \alpha_{i-1} \alpha_{i+1}...\alpha_{N}} 
  =
  (-1)^{i-1} 
  \ket{\alpha_1 \alpha_2 ... \alpha_{i-1} \alpha_i \alpha_{i+1} ... \alpha_{N}}.
\end{eq}
Note that when $a_\alpha^\dag$ acts on a state that already contains a particle with quantum numbers $\alpha$, the result is 0, because of antisymmetry\todo{is it really antisymmetry? what about pauli?}
\begin{eq}
  \label{eq:create_zero}
  a_{\alpha}^{\dagger} \ket{\alpha\alpha_1 \alpha_2 ... \alpha_N} 
  =
  0.
\end{eq}

The adjoint of the creation operator is called the \emph{annihilation operator} $a_\alpha$. 
It can be shown to have the opposite effect, removing a particle, when acting on a state
\begin{eq}
  \label{eq:annihilate}
  a_{\alpha} \ket{\alpha \alpha_1 \alpha_2 ... \alpha_N}
  =
  \ket{\alpha_1 \alpha_2 ... \alpha_N}.
\end{eq}
Here, too, a sign might appear from the ordering
\begin{eq}
  \label{eq:annihilate_ordered}
  a_{\alpha_i}
  \ket{\alpha_1 \alpha_2 ... \alpha_{i-1} \alpha_i \alpha_{i+1} ... \alpha_N}
  =
  (-1)^{i-1}
  \ket{\alpha_1 \alpha_2 ... \alpha_{i-1} \alpha_{i+1}...\alpha_N}.
\end{eq}
Analogous to $a_\alpha^\dag$, when $a_\alpha$ acts on a state that does not contain a particle with the quantum numbers $\alpha$, the result is 0
\begin{eq}
  \label{eq:annihilate_zero}
  a_\alpha \ket{\alpha_1 \alpha_2 ... \alpha_N} 
  =
  0.
\end{eq}


\subsection{General Operators in Fock Space}

We can now express the state of any number of particles, but in order to do something with the states we also need to express operators such as the Hamiltonian in the Fock space formalism. 
General operators, involving any number of particles, can be expressed using the creation and annihilation operators. \todo[inline]{what a pleasant surprise}
The operators can then act on a state with an arbitrary number of particles. 
We will only treat one- and two-body operators here, as they are sufficient for our purposes.
\todo[inline]{There are many operators here...}

\subsubsection{One-Body Operators}

A one-body operator $H_1$ which acts on a single sp state, is represented by the Fock space operator
\begin{eq}
  \hat{H}_1
  =
  \sum_{\alpha \beta} 
  \bra\alpha H_1 \ket\beta 
  a_\alpha^\dag a_\beta.
\end{eq}
It is important to note that while the sum runs over the complete set of sp states twice, only a few terms will be non-zero, because of the operator rules in \cref{eq:create_zero,eq:annihilate_zero}. 

\todo{$\alpha$ bad notation?}
If the sp-states are eigenstates to the one-body operator
\begin{eq}
  H_1 \ket{\alpha_i} = h_i \ket{\alpha_i}
\end{eq}
the matrix elements only exist on the diagonal, when $\alpha = \beta$, and we get
\begin{eq}
  \hat{H}_1
  =
  \sum_{\alpha} 
  \bra\alpha H_1 \ket\alpha
  a_\alpha^\dag a_\alpha.
\end{eq}
\todo{sandwiched?}Sandwiched between a bra and a ket, this becomes
\begin{eq}
  \label{eq:one-body_matrix_elements}
  \bra{\alpha_1\dots\alpha_N} \hat{H}_1 \ket{\alpha'_1\dots\alpha'_N}
  & =
  \sum_{\alpha} 
  \bra\alpha H_1 \ket\alpha
  \bra{\alpha_1\dots\alpha_N} 
  a_\alpha^\dag a_\alpha
  \ket{\alpha'_1\dots\alpha'_N}
  \\ & =
  \sum_{i = 1}^N 
  \bra{\alpha_i} H_1 \ket{\alpha_i}
  \braket{\alpha_1\dots\alpha_N}{\alpha'_1\dots\alpha'_N}
  \\ & =
  \p{
    h_1 + \dots + h_N
  }
  \delta_{\alpha_1\alpha'_1} \dots \delta_{\alpha_N\alpha'_N},
\end{eq}
\todo[inline]{for kets outside sum: use <a...b|H|c...d>?}
the sum of the eigenvalues of the sp states in the bra and ket, but only if the bra and ket are the same. The Fock space operator $\hat{H}_1$ is thus also diagonal.

\subsubsection{Two-Body Operators}
\todo{notations}
A two-body operator in Fock space becomes
\begin{eq}
  \hat{H}_2
  =
  \frac{1}{2}\sum_{\alpha \beta \gamma \delta} 
  \pbra{\alpha \beta} H_2 \pket{\gamma \delta} 
  a_\alpha^\dag a_\beta^\dag a_\delta a_\gamma.
\end{eq}
\todo{Give an example of a $H_2$? Like, mention $V(\vec{r}_1,\, \vec{r}_2)$?}Note that the ordering of the $\gamma$ and $\delta$ is different for the product states and the operators, so-called \emph{normal ordering}.
The factor \nicefrac{1}{2} stems from the fact that %%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{eq}
  \pbra{\alpha \beta} H_2 \pket{\gamma \delta} 
  = 
  \pbra{\beta \alpha} H_2 \pket{\delta \gamma}
\end{eq}
and we are counting both.

We can also express $\hat{H}_2$ using matrix elements between antisymmetric states
\begin{eq}
  \bra{\alpha\beta} H_2 \ket{\gamma\delta} 
  = 
  \pbra{\alpha\beta} H_2 \pket{\gamma\delta}
  -
  \pbra{\alpha\beta} H_2 \pket{\delta\gamma},
\end{eq}
but we will have to add another factor \nicefrac{1}{2} to compensate for double counting
\begin{eq}
  \hat{H}_2
  =
  \frac{1}{4}\sum_{\alpha \beta \gamma \delta} 
  \bra{\alpha \beta} H_2 \ket{\gamma \delta} 
  a_\alpha^\dag a_\beta^\dag a_\delta a_\gamma.
\end{eq}
The double counting can be avoided, however, by taking into account the ordering of the states
\begin{eq}
  \hat{H}_2
  =
  \sum_{\substack{\alpha < \beta \\ \gamma < \delta}} 
  \bra{\alpha \beta} H_2 \ket{\gamma \delta} 
  a_\alpha^\dag a_\beta^\dag a_\delta a_\gamma.
\end{eq}

For the case of two particles we have
\begin{eq}
  \label{eq:two-body_matrix_elements}
  \bra{ab} \hat{H}_2 \ket{cd}
  & =
  \sum_{\substack{\alpha < \beta \\ \gamma < \delta}} 
  \bra{\alpha \beta} H_2 \ket{\gamma \delta} 
  \bra{ab} 
  a_\alpha^\dag a_\beta^\dag a_\delta a_\gamma
  \ket{cd}
  \\ & =
  \sum_{\substack{\alpha < \beta \\ \gamma < \delta}} 
  \bra{\alpha \beta} H_2 \ket{\gamma \delta}
  \delta_{\alpha a}\delta_{\beta b}
  \delta_{\gamma c}\delta_{\delta d}
  \\ & =
  \bra{ab} H_2 \ket{cd},
\end{eq}
as expected.



\section{Implementation}

To use the Fock space formalism in numerical calculations we have to represent the quantum states using available data structures. 
We construct sp states and use them to form antisymmetric Fock states.
The creation and annihilation operators become functions that take the Fock states as arguments, and are used to create the Fock operators. 
Furthermore, the sum in the expression of the Fock operators can be optimized by only evaluating the non-zero terms.

\subsection{Single-Particle-State Objects}

We represent a single particle state with a record, i.e. an object with named fields that can be assigned values. It is natural to let each quantum number, such as $l$ and $j$ be a field. 
Moreover, we can include other information about the state, information that is taken for granted in the mathematical formulation.
This includes a unique index for each state, the eigenvector holding information about the wavefunction, the basis of the eigenvector and, in the case of the plane wave basis, the contour used.
Much of this extra information is redundant, as many states share the same information.
Nevertheless, we found that this representation significantly simplifies the structure of the program and makes it easier to understand.

\subsection{Fock State Objects and Operator Functions}

An antisymmetric many-body state $\ket{\alpha_1\dots}$ is represented by an ordered list of single particle objects and a sign. 
Since the sp state objects have a unique index, there is a well-defined sorting order. 
The sign can be $1$, $-1$ or $0$, representing $\ket{\alpha_1\dots}$, $-\ket{\alpha_1\dots}$ and $0$, respectively. 

The creation and annihilation operators are implemented as functions on the Fock state objects, obeying
\cref{eq:create,eq:create_ordered,eq:create_zero,eq:annihilate,eq:annihilate_ordered,eq:annihilate_zero}.
The creation operator function steps through the list, flipping the sign at each step, until the correct place for the new particle is found. 
If the particle is already part of the Fock state, the sign is set to 0.
The annihilation operator searches for a state, saves its index $k$ in the list, annihilates it and set the sign to $(-1)^k$. If the state not exists, the sign is set to 0.

\subsection{Matrix Element Computations}

When computing the matrix elements, we do do not
\todo{finish this section}

\section{Angular Momentum Coupling}
\label{sec:coupling}
We have now developed the tools we need to create the Hamiltonian matrix and solve the problem. 
First, however, we will discuss the concept of angular momentum coupling. 
This corresponds to making a change of basis, using the rotational symmetry of the problem to significantly reduce the size of the matrix. 
In principle this is not neccesary to solve the problem, but it is a neat trick to make the computations more managable. 
The following section introduces the concept of angular momentum coupling. \todo{refer to souhonen or somewhere where this coupling is satisfactorily explained}
 
%The \He{6} nucleus can be solved in two ways, either we couple the angular momenta of the two sp states to reduce the amount of calculations needed or we generate all mb states to get calculations that are more straight-forward. 
%We solve the problem using both schemes, the coupled scheme because is is the one we want to use, but we also solve it using the uncoupled scheme to verify the answer.
%Both schemes can be used together when solving in both the HO basis and the k basis. 
%We will cover all four approaches in this chapter.

%\subsection{Uncoupled Scheme}
%In the uncoupled scheme we use a mb basis, $\alpha$, formed from two sp solutions, $a,b$, and give each sp state an m quantum number. In order to reduce the calculatins needed we filter the mb states so the sum of m numbers equals M.


\subsection{Coupled Scheme}
So far we have used the basis states 
\begin{eq}
  \pket{E_1m_1, E_2m_2} = \ket{E_1j_1m_1}\otimes\ket{E_2j_2m_2}
\end{eq}
that are eigenvectors to the \He{5} Hamiltonian (with eigenvalues $E_1+E_2$). 
However, they are also constructed so that they are eigenvectors to the operators $\vec{J}_1^2$ and $\vec{J}_2^2$ with eigenvalues $j_1(j_1+1)$ and $j_2(j_2+1)$ respectively, and the operators $\vec{J}_{1z}$ and $\vec{J}_{2z}$ with eigenvalues $m_1$ and $m_2$. \todo{det här egenvektorer till alla operatorer som vi vill, är det uppenbart eller har vi gjort något smart så att det blir så? behövs citerng?}


One often studies systems where the total angular momentum $\vec{J} = \vec{J}_1 + \vec{J}_2$ is conserved, but the individual angular momenta $\vec{J}_1$ and $\vec{J}_2$ are not. 
Then it is convenient to switch to a basis $\pket{E_1, E_2; JM}$ where the total angular momentum is well defined, but the individual momenta are not. 
You may then significantly reduce the size of the Hamiltonian matrix by considering systems of various $J$ and $M$ separately. 
\todo[inline]{such as ours?}

The reader may confirm that $J^2$, $J_z$, $J_1^2$ and $J_2^2$ commute with each other. 
This means that one may choose a basis where $J$, $M$, $j_1$ and $j_2$ are simultanously well-defined. However, this is not the case with $m_1$ and $m_2$, and you neccesarily have \todo{trivialt? eller citera?}
\begin{eq}
  \pket{E_1, E_2; JM} = \sum_{m_1, m_2} c_{m_1 m_2} \pket{E_1m_1, E_2m_2}
\end{eq}
where the $j$'s are no longer explicitly written out since they are fixed for any given calculation. The transformation is done with the coefficients $c_{m_1 m_2}$, formally written as \todo{take on one value? please elaborate}
\begin{eq}
  c_{m_1 m_2} = \pbraket{j_1 m_1, j_2 m_2}{JM},
\end{eq}
known as the \emph{Clebsch-Gordan coefficients}. There are known expressions for these, and values can be found in standard tables. \todo{citation or at least explain what we do}

Since we are studying fermions, we need to use basis states that are antisymmetric with respect to exchange of all quantum numbers. Using the symmetry property of the Clebsch-Gordan coefficients,
\begin{eq}
  c_{m_2 m_1} = (-1)^{j_1 + j_2 - J} c_{m_1 m_2} 
\end{eq}
we can see that
\begin{eq}
  \pket{E_2, E_1; JM} 
  & = 
  \sum_{m_1, m_2} c_{m_1 m_2} \pket{E_2 m_1, E_1 m_2} 
  \\ & = 
  (-1)^{j_1+j_2-J}\sum_{m_1, m_2} c_{m_1 m_2} \pket{E_2 m_2, E_1 m_1}
\end{eq}
Hence it is possible to form the antisymmetric basis vector
\begin{eq}
  \ket{E_1 E_2; JM} &= \frac{1}{\sqrt{2}}\bigp{\pket{E_1 E_2;JM} - (-1)^{j_1+j_2-J}\pket{E_2 E_1;JM}} \\
  &= \sum_{m_1, m_2} c_{m_1 m_2} \ket{E_1 m_1, E_2 m_2}.
\end{eq}
Now consider the case where both particles are in the same orbital, $E_1 j_1 = E_2 j_2 = E j$. Since $j$ is half-numbered for fermions, we will have $(-1)^{j_1+j_2 - J} = - (-1)^J$, and we get
\begin{eq}
  \ket{E^2; JM} = \frac{1+(-1)^J}{\sqrt{2}}\pket{E^2; JM} .
\end{eq} 
\todo{ugly kets?}
We see that this state is equal to the vacuum state for $J$ odd. However, for $J$ even, we find that the norm
\begin{eq}
  \braket{E^2; JM}{E^2; JM} = 2
\end{eq}
meaning that we have to normalize these states with an additional factor $\nicefrac{1}{\sqrt{2}}$. This can formally be written
\begin{eq}
  \ket{E_1 E_2; JM} 
  = 
  \frac{1}{\sqrt{1+\delta_{E_1 E_2}}}\sum_{m_1, m_2} c_{m_1 m_2} \ket{E_1 m_1, E_2 m_2}
\end{eq}

\subsection{Matrix elements in coupled scheme}
\todo{Write about matrix elements}

\end{document}
