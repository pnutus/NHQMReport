\documentclass[../main/report.tex]{subfiles}
\begin{document}
  
\chapter{Many-Body Theory and Implementation}
\label{cha:many-body}
\todo{mer röd tråd}  

We have solved the nuclear two-body problem and studied its resonances.
The next step is to add another particle and subsequently solve the three-body problem. 
However, while the two-body problem is reducible to a radial one-dimensional problem, the general many-body problem is not.
Instead, we need to use a single particle (sp) basis to construct many-body states.
This chapter covers the construction of such states.

First, the mathematical consequences of identical, indistinguishable particles is presented, focusing on fermions.
This is followed by a short introduction fo the second quantization formalism, which allows calculations with an arbitrary number of particles.
Finally, we discuss the practical usage of second quantization and present a simple implementation for fermions.

\section{Identical Particles}

A quirk of quantum mechanics is that particles that look identical \emph{are} identical, for all intents and purposes. For example, in the case of the two neutrons orbiting the core, the neutrons are impossible to distinguish from one another. This has to be taken into consideration when dealing with many-body states of identical particles, as we will see.

We begin with an orthonormal single particle (sp) basis $\ket{\alpha_i}$, where $\alpha_i$ represents all the quantum numbers that describe the state.
Next, consider $N$ identical particles, expressed in this basis. We form a product state
\begin{eq}
  \pket{\alpha_1\alpha_2\dots\alpha_N} 
  \equiv
  \ket{\alpha_1} \otimes \ket{\alpha_2} \otimes \dots \otimes \ket{\alpha_N}
  =
  \ket{\alpha_1}\ket{\alpha_2}\dots\ket{\alpha_N},
\end{eq}
which, by the orthonormality of the $\ket\alpha$, will be orthonormal as well
\begin{eq}
  \pbraket{\alpha_1\alpha_2\dots\alpha_N}{\alpha'_1\alpha'_2\dots\alpha'_N}
  =
  \braket{\alpha_1}{\alpha'_1}
  \braket{\alpha_2}{\alpha'_2}
  \dots
  \braket{\alpha_N}{\alpha'_N}.
\end{eq}

Let us now create an arbitrary linear combination of the product states, denoted by an angled ket
\begin{eq}
  \ket{\alpha_1\alpha_2\dots\alpha_N}.
\end{eq}
Since the particles are identical, and thus indistinguishable, we require the norm of the state to be unchanged when swapping the quantum numbers of two particles $i$ and $j$
\begin{eq}
  \absq{\big.\ket{\alpha_1\dots\alpha_i\dots\alpha_j\dots\alpha_N}}
  =
  \absq{\big.\ket{\alpha_1\dots\alpha_j\dots\alpha_i\dots\alpha_N}}.
\end{eq}
These states can therefore only differ in phase $e^{i\phi}$, and since another swap will bring us back to the original state, the phase has to be either $e^{i\phi} = 1$ or $e^{i\phi} = -1$.
Symmetric states with no phase change describe \emph{bosons}, whereas antisymmetric states that change sign describe \emph{fermions}.
In this report all our sp states will be fermionic, hence we do not treat the bosonic case.
\todo[inline]{tappade röda tråden här}
\subsection{Antisymmetric Fermion states}

We have now established that our fermion many-body states are a linear combination of product states that satisfy
\begin{eq}
  \ket{\alpha_1\dots\alpha_i\dots\alpha_j\dots\alpha_N}
  =
  -\ket{\alpha_1\dots\alpha_j\dots\alpha_i\dots\alpha_N}.
\end{eq}
For example, in the case of two particles, the correctly normalized antisymmetric state is
\begin{eq}
  \ket{\alpha_1\alpha_2} 
  = 
  \frac{1}{\sqrt{2}}
  \bigp{
    \pket{\alpha_1\alpha_2} - \pket{\alpha_2\alpha_1}
  }.
\end{eq}
We will henceforth use the angular ket notation $\ket\dots$ for antisymmetric states, as opposed to $\pket\dots$ for product states.

\todo[inline]{completeness relation? Orthonormality?}

Important to note is that states with permuted quantum numbers, such as the states $\ket{\alpha_1\alpha_2}$ and $\ket{\alpha_2\alpha_1}$, represent the same physical state, as they only differ in sign (phase). 
This means that we have to make sure not to double count these states. 
We can do this by requiring the sp states to always appear in the same order in the ket. 
If they are not, we permute two sp states at a time until the correct ordering is reached
\begin{eq}
  \ket{\alpha_i\alpha_1\dots\alpha_{i-1}\alpha_{i+1}\dots\alpha_N}
  & =
  - \ket{\alpha_1\alpha_i\dots\alpha_{i-1}\alpha_{i+1}\dots\alpha_N}
  \\ & =
  (-1)^{i-2} 
  \ket{\alpha_1\dots\alpha_i\alpha_{i-1}\alpha_{i+1}\dots\alpha_N}
  \\ & =
  (-1)^{i-1} 
  \ket{\alpha_1\dots\alpha_{i-1}\alpha_i\alpha_{i+1}\dots\alpha_N}.
\end{eq}

\section{Second quantization and Fock Space}

So far we've looked at a system with a fixed number of particles, but we want to work with a system with an arbitrary number of identical particles. 
The construction that lets us do this is called the \emph{Fock space}. 
\todo{why?/cite/explain citation at start of chapter, covering all our bases :)}
A state in Fock space, a \emph{Fock state}, can contain any number of particles. 
States with different number of particles are orthogonal to each other.

\subsection{Creation and Annihilation Operators}
\todo{how do we denote the ops? a? c?}


\todo{particle addition/removal operators?}
The simplest Fock state is the \emph{vacuum state} $\ket{0}$, which describes a system with no particles. 
All other states can be created from the vacuum state using the \emph{creation operator} $a_\alpha^\dag$, which adds a particle with quantum numbers $\alpha$ to a state
\begin{eq}
  \label{eq:create}
  a_{\alpha}^{\dagger} \ket{\alpha_1 \alpha_2 ... \alpha_N} 
  =
  \ket{\alpha \alpha_1 \alpha_2 ... \alpha_N}.
\end{eq}
The resulting state will not necessarily be ordered, and the ordering might contribute a sign:
\begin{eq}
  \label{eq:create_ordered}
  a_{\alpha_i}^{\dagger} 
  \ket{\alpha_1 \alpha_2 ... \alpha_{i-1} \alpha_{i+1}...\alpha_{N}} 
  =
  (-1)^{i-1} 
  \ket{\alpha_1 \alpha_2 ... \alpha_{i-1} \alpha_i \alpha_{i+1} ... \alpha_{N}}.
\end{eq}
Note that when $a_\alpha^\dag$ acts on a state that already contains a particle with quantum numbers $\alpha$, the result is 0, because of antisymmetry
\begin{eq}
  \label{eq:create_zero}
  a_{\alpha}^{\dagger} \ket{\alpha\alpha_1 \alpha_2 ... \alpha_N} 
  =
  0.
\end{eq}

The adjoint of the creation operator is called the \emph{annihilation operator} $a_\alpha$. 
It can be shown to have the opposite effect, removing a particle, when acting on a state
\begin{eq}
  \label{eq:annihilate}
  a_{\alpha} \ket{\alpha \alpha_1 \alpha_2 ... \alpha_N}
  =
  \ket{\alpha_1 \alpha_2 ... \alpha_N}.
\end{eq}
Here, too, a sign might appear from the ordering
\begin{eq}
  \label{eq:annihilate_ordered}
  a_{\alpha_i}
  \ket{\alpha_1 \alpha_2 ... \alpha_{i-1} \alpha_i \alpha_{i+1} ... \alpha_N}
  =
  (-1)^{i-1}
  \ket{\alpha_1 \alpha_2 ... \alpha_{i-1} \alpha_{i+1}...\alpha_N}.
\end{eq}
Analogous to $a_\alpha^\dag$, when $a_\alpha$ acts on a state that does not contain a particle with the quantum numbers $\alpha$, the result is 0
\begin{eq}
  \label{eq:annihilate_zero}
  a_\alpha \ket{\alpha_1 \alpha_2 ... \alpha_N} 
  =
  0.
\end{eq}


\subsection{General Operators in Fock Space}

We can now express the state of any number of particles, but in order to do something with the states we also need to express operators in the Fock space formalism. It turns out that operators involving any number of particles can be expressed using the creation and annihilation operators. The operators can then act on a state with an arbitrary number of particles. We will only treat one- and two-body operators here, as they are all we need in this report.

\subsubsection{One-Body Operators}

A one-body operator $H_1$ which acts on a single sp state, is represented by the Fock space operator
\begin{eq}
  \hat{H}_1
  =
  \sum_{\alpha \beta} 
  \bra\alpha H_1 \ket\beta 
  a_\alpha^\dag a_\beta.
\end{eq}
It is important to note that, while the sum runs over the complete set of sp states twice, only a few terms will be non-zero, because of the operator rules in \cref{eq:creation_zero,eq:annihilation_zero}. 

\todo{$\alpha$ bad notation?}
If the sp-states are eigenstates to the one-body operator
\begin{eq}
  H_1 \ket{\alpha_i} = h_i \ket{\alpha_i}
\end{eq}
the matrix elements only exist on the diagonal, when $\alpha = \beta$, and we get
\begin{eq}
  \hat{H}_1
  =
  \sum_{\alpha} 
  \bra\alpha H_1 \ket\alpha
  a_\alpha^\dag a_\alpha.
\end{eq}
Sandwiched between a bra and a ket, this becomes
\begin{eq}
  \bra{\alpha_1\dots\alpha_N} \hat{H}_1 \ket{\alpha'_1\dots\alpha'_N}
  & =
  \sum_{\alpha} 
  \bra\alpha H_1 \ket\alpha
  \bra{\alpha_1\dots\alpha_N} 
  a_\alpha^\dag a_\alpha
  \ket{\alpha'_1\dots\alpha'_N}
  \\ & =
  \sum_{i = 1}^N 
  \bra{\alpha_i} H_1 \ket{\alpha_i}
  \braket{\alpha_1\dots\alpha_N}{\alpha'_1\dots\alpha'_N}
  \\ & =
  \p{
    h_1 + \dots + h_N
  }
  \delta_{\alpha_1\alpha'_1} \dots \delta_{\alpha_N\alpha'_N},
\label{eq:one-body interaction}
\end{eq}
the sum of the eigenvalues of the sp states in the bra and ket, but only if the bra and ket are the same. The Fock space operator $\hat{H}_1$ is thus also diagonal.

\subsubsection{Two-Body Operators}
\todo{notations}
A two-body operator in Fock space becomes
\begin{eq}
  \hat{H}_2
  =
  \frac{1}{2}\sum_{\alpha \beta \gamma \delta} 
  \pbra{\alpha \beta} H_2 \pket{\gamma \delta} 
  a_\alpha^\dag a_\beta^\dag a_\delta a_\gamma.
\end{eq}
Note that the ordering of the $\gamma$ and $\delta$ is different for the product states and the operators, so-called \emph{normal ordering}.
The factor \nicefrac{1}{2} stems from the fact that %%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{eq}
  \pbra{\alpha \beta} H_2 \pket{\gamma \delta} 
  = 
  \pbra{\beta \alpha} H_2 \pket{\delta \gamma}
\end{eq}
and we are counting both.

We can also express $\hat{H}_2$ using matrix elements between antisymmetric states
\begin{eq}
  \bra{\alpha\beta} H_2 \ket{\gamma\delta} 
  = 
  \pbra{\alpha\beta} H_2 \pket{\gamma\delta}
  -
  \pbra{\alpha\beta} H_2 \pket{\delta\gamma},
\end{eq}
but we will have to add another factor \nicefrac{1}{2} to compensate for double counting
\begin{eq}
  \hat{H}_2
  =
  \frac{1}{4}\sum_{\alpha \beta \gamma \delta} 
  \bra{\alpha \beta} H_2 \ket{\gamma \delta} 
  a_\alpha^\dag a_\beta^\dag a_\delta a_\gamma.
\end{eq}
The double counting can be avoided, however, by taking into account the ordering of the states
\begin{eq}
  \hat{H}_2
  =
  \sum_{\substack{\alpha < \beta \\ \gamma < \delta}} 
  \bra{\alpha \beta} H_2 \ket{\gamma \delta} 
  a_\alpha^\dag a_\beta^\dag a_\delta a_\gamma.
\end{eq}

For the case of two particles we have
\begin{eq}
  \bra{ab} \hat{H}_2 \ket{cd}
  & =
  \sum_{\substack{\alpha < \beta \\ \gamma < \delta}} 
  \bra{\alpha \beta} H_2 \ket{\gamma \delta} 
  \bra{ab} 
  a_\alpha^\dag a_\beta^\dag a_\delta a_\gamma
  \ket{cd}
  \\ & =
  \sum_{\substack{\alpha < \beta \\ \gamma < \delta}} 
  \bra{\alpha \beta} H_2 \ket{\gamma \delta}
  \delta_{\alpha a}\delta_{\beta b}
  \delta_{\gamma c}\delta_{\delta d}
  \\ & =
  \bra{ab} H_2 \ket{cd},
\end{eq}
as expected.



\section{Implementation}

To use the fock space formalism in numerical calculations we have to represent the quantum states using available data structures. 
We construct sp states and use them to form antisymmetric Fock states.
The creation and annihilation operators become functions that take the Fock states as arguments, and are used to create the Fock operators. 
Furthermore, the sum in the expression of the Fock operators can be optimized by only evaluating the non-zero terms.

\subsection{Single-Particle-State Objects}

We represent a single particle state with a record, i.e. an object with named fields that can be assigned values. It is natural to let each quantum number, such as $l$ and $j$ be a field. 
Moreover, we can include other information about the state, information that is taken for granted in the mathematical formulation.
This includes a unique id number for each state, the eigenvector holding information about the wavefunction, the basis of the eigenvector and, in the case of the plane wave basis, the contour used.
Much of this extra information is redundant, as many states share the same information.
Nevertheless, we found that this representation significantly simplifies the structure of the program and makes it easier to understand.

\subsection{Fock State Objects and Operator Functions}

An antisymmetric many-body state $\ket{\alpha_1\dots}$ is represented by an ordered list of single particle objects and a sign. 
Since the sp state objects have a unique id, there is a well-defined sorting order. 
The sign can be $1$, $-1$ or $0$, representing $\ket{\alpha_1\dots}$, $-\ket{\alpha_1\dots}$ and $0$, respectively. 

The creation and annihilation operators are implemented as functions on the Fock state objects, obeying
\cref{eq:create,eq:create_ordered,eq:create_zero,eq:annihilate,eq:annihilate_ordered,eq:annihilate_zero}.
The creation operator function steps through the list, flipping the sign at each step, until the correct place for the new particle is found. 
If the particle is already part of the Fock state, the sign is set to 0.
The annihilation operator searches for a state, saves its index $k$ in the list, annihilates it and set the sign to $(-1)^k$. If the state does not exist the sign is set to 0.

\subsection{Matrix Element Calculations}

When calculating the matrix elements, we do do not

\todo{Write about matrix elements}

\end{document}
